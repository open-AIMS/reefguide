<div class="model-invoke-container">
  <!-- Job Status Display (shown when job is active) -->
  <app-job-status
    *ngIf="currentJob()"
    [job]="currentJob()"
    [config]="jobConfig"
    [visible]="true"
    (jobCompleted)="onJobCompleted($event)"
    (retryRequested)="onRetryRequested()"
    (cancelRequested)="onCancelRequested()"
  >
  </app-job-status>

  <!-- Form (hidden when job is running) -->
  <mat-card *ngIf="!currentJob()" class="form-card">
    <mat-card-header>
      <mat-card-title>Configure Model Run Parameters</mat-card-title>
      <mat-card-subtitle
        >Set coral deployment parameters for reef restoration simulation</mat-card-subtitle
      >
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="myForm" (ngSubmit)="onSubmit()">
        <!-- Number of Scenarios -->
        <div class="form-section">
          <h3>Simulation Parameters</h3>

          <div class="form-field">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Number of Scenarios</mat-label>
              <mat-select formControlName="numScenarios">
                <mat-option *ngFor="let option of scenarioOptions" [value]="option">
                  {{ option }} scenario{{ option === 1 ? '' : 's' }}
                </mat-option>
              </mat-select>
              <mat-hint>Choose a power of 2 for optimal performance</mat-hint>
            </mat-form-field>
          </div>
        </div>

        <!-- Tabular Acropora -->
        <div class="form-section">
          <h3>Tabular Acropora (TA) Deployment</h3>

          <div class="range-inputs">
            <div class="form-field">
              <label for="ta_lower">Minimum Deployment</label>
              <mat-slider
                id="ta_lower"
                formControlName="ta_lower"
                min="0"
                max="1000000"
                step="100000"
                discrete
                [displayWith]="millionDeployed"
              >
              </mat-slider>
              <div class="slider-value">{{ millionDeployed(myForm.get('ta_lower')?.value) }}</div>
            </div>

            <div class="form-field">
              <label for="ta_upper">Maximum Deployment</label>
              <mat-slider
                id="ta_upper"
                formControlName="ta_upper"
                min="0"
                max="1000000"
                step="100000"
                discrete
                [displayWith]="millionDeployed"
              >
              </mat-slider>
              <div class="slider-value">{{ millionDeployed(myForm.get('ta_upper')?.value) }}</div>
            </div>
          </div>
        </div>

        <!-- Corymbose Acropora -->
        <div class="form-section">
          <h3>Corymbose Acropora (CA) Deployment</h3>

          <div class="range-inputs">
            <div class="form-field">
              <label for="ca_lower">Minimum Deployment</label>
              <mat-slider
                id="ca_lower"
                formControlName="ca_lower"
                min="0"
                max="1000000"
                step="100000"
                discrete
                [displayWith]="millionDeployed"
              >
              </mat-slider>
              <div class="slider-value">{{ millionDeployed(myForm.get('ca_lower')?.value) }}</div>
            </div>

            <div class="form-field">
              <label for="ca_upper">Maximum Deployment</label>
              <mat-slider
                id="ca_upper"
                formControlName="ca_upper"
                min="0"
                max="1000000"
                step="100000"
                discrete
                [displayWith]="millionDeployed"
              >
              </mat-slider>
              <div class="slider-value">{{ millionDeployed(myForm.get('ca_upper')?.value) }}</div>
            </div>
          </div>
        </div>

        <!-- Small Massives -->
        <div class="form-section">
          <h3>Small Massives (SM) Deployment</h3>

          <div class="range-inputs">
            <div class="form-field">
              <label for="sm_lower">Minimum Deployment</label>
              <mat-slider
                id="sm_lower"
                formControlName="sm_lower"
                min="0"
                max="1000000"
                step="100000"
                discrete
                [displayWith]="millionDeployed"
              >
              </mat-slider>
              <div class="slider-value">{{ millionDeployed(myForm.get('sm_lower')?.value) }}</div>
            </div>

            <div class="form-field">
              <label for="sm_upper">Maximum Deployment</label>
              <mat-slider
                id="sm_upper"
                formControlName="sm_upper"
                min="0"
                max="1000000"
                step="100000"
                discrete
                [displayWith]="millionDeployed"
              >
              </mat-slider>
              <div class="slider-value">{{ millionDeployed(myForm.get('sm_upper')?.value) }}</div>
            </div>
          </div>
        </div>
      </form>
    </mat-card-content>

    <mat-card-actions align="end">
      <button
        mat-raised-button
        color="primary"
        type="submit"
        [disabled]="myForm.invalid || isSubmitting()"
        (click)="onSubmit()"
      >
        <span *ngIf="!isSubmitting()">Start Model Run</span>
        <span *ngIf="isSubmitting()">Starting...</span>
      </button>
    </mat-card-actions>
  </mat-card>
</div>
