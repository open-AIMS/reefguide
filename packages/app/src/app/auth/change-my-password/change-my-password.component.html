<mat-card>
  <h3>Change my password</h3>
  <form [formGroup]="changePasswordForm" (ngSubmit)="onSubmit()" class="auth-form">
    <div class="form-fields">
      <mat-form-field>
        <mat-label>Current password</mat-label>
        <input
          matInput
          formControlName="currentPassword"
          [type]="hideCurrentPassword ? 'password' : 'text'"
          autocomplete="current-password"
          [attr.aria-label]="'Current password'"
        />
        <button
          mat-icon-button
          matSuffix
          type="button"
          (click)="hideCurrentPassword = !hideCurrentPassword"
          [attr.aria-label]="'Toggle current password visibility'"
        >
          <mat-icon>{{ hideCurrentPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        @if (currentPassword.errors?.['required']) {
          <mat-error>Current password is required</mat-error>
        }
      </mat-form-field>

      <mat-form-field>
        <mat-label>New password</mat-label>
        <input
          matInput
          formControlName="newPassword"
          [type]="hideNewPassword ? 'password' : 'text'"
          autocomplete="new-password"
          [attr.aria-label]="'New password'"
        />
        <button
          mat-icon-button
          matSuffix
          type="button"
          (click)="hideNewPassword = !hideNewPassword"
          [attr.aria-label]="'Toggle new password visibility'"
        >
          <mat-icon>{{ hideNewPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        @if (newPassword.errors?.['required']) {
          <mat-error>New password is required</mat-error>
        }
        @if (newPassword.errors?.['minlength']) {
          <mat-error>Password must be at least 8 characters</mat-error>
        }
      </mat-form-field>

      <mat-form-field>
        <mat-label>Confirm new password</mat-label>
        <input
          matInput
          formControlName="confirmPassword"
          [type]="hideConfirmPassword ? 'password' : 'text'"
          autocomplete="new-password"
          [attr.aria-label]="'Confirm new password'"
        />
        <button
          mat-icon-button
          matSuffix
          type="button"
          (click)="hideConfirmPassword = !hideConfirmPassword"
          [attr.aria-label]="'Toggle confirm password visibility'"
        >
          <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        @if (confirmPassword.errors?.['required']) {
          <mat-error>Confirm password is required</mat-error>
        }
        @if (confirmPassword.errors?.['minlength']) {
          <mat-error>Password must be at least 8 characters</mat-error>
        }
      </mat-form-field>
    </div>

    <div class="form-actions">
      <button
        mat-raised-button
        color="primary"
        type="submit"
        [disabled]="!changePasswordForm.valid || isSubmitting()"
      >
        @if (isSubmitting()) {
          Changing Password...
        } @else {
          Change Password
        }
      </button>
    </div>
  </form>
</mat-card>
