<mat-form-field appearance="outline" class="search-field" subscriptSizing="dynamic">
  <mat-icon matPrefix class="search-icon">search</mat-icon>
  <input
    matInput
    [matAutocomplete]="auto"
    [formControl]="searchControl"
    placeholder="Search for reefs..."
  />
</mat-form-field>

<mat-autocomplete
  #auto="matAutocomplete"
  panelWidth="30em"
  autoActiveFirstOption="true"
  [displayWith]="displayReef"
  (optionSelected)="onReefSelected($event)"
>
  @for (option of reefSearchService.results()?.results ?? []; track option.id) {
    <mat-option [value]="option" class="reef-option">
      <span class="reef-name">{{ option.name }}</span>
    </mat-option>
  }

  @if (reefSearchService.searching()) {
    <mat-option disabled>
      <span class="loading-text">Searching...</span>
    </mat-option>
  }

  @if (reefSearchService.error()) {
    <mat-option disabled>
      <span class="error-text">{{ reefSearchService.error() }}</span>
    </mat-option>
  }

  @if (
    !reefSearchService.searching() &&
    !reefSearchService.error() &&
    reefSearchService.results() &&
    (reefSearchService.results()?.results?.length ?? 0) === 0
  ) {
    <mat-option disabled>
      <span class="no-results-text">No reefs found</span>
    </mat-option>
  }
</mat-autocomplete>
